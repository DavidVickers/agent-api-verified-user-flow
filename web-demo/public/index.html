<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIAW Verified User Demo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <h1>MIAW Verified User Demo</h1>
            <span class="header-subtitle">Salesforce Agent API — Verified Identity Flow</span>
        </div>
        <div class="header-right">
            <span id="status-badge" class="status-badge disconnected">Disconnected</span>
            <button id="connect-btn" class="btn-connect">Connect</button>
        </div>
    </header>

    <main>
        <!-- Left panel: Flow log -->
        <aside id="log-panel">
            <div class="panel-header">Flow Log</div>
            <div id="log-area"></div>
        </aside>

        <!-- Right panel: Chat -->
        <section id="chat-panel">
            <div id="chat-area">
                <!-- Pre-connect: show the full flow and assumptions -->
                <div id="pre-connect" class="pre-connect">
                    <h2>Verified User Flow</h2>
                    <p class="pre-subtitle">
                        This demo shows how a <strong>verified identity</strong> is passed
                        to a Salesforce Agent via the MIAW Custom Client API.
                    </p>

                    <div class="flow-diagram">
                        <div class="flow-step completed">
                            <div class="flow-number">0</div>
                            <div class="flow-content">
                                <div class="flow-title">User Authenticates with Identity Provider</div>
                                <div class="flow-desc">
                                    In production, the user logs in via an IdP (e.g. Okta, Auth0, Azure AD)
                                    and receives a signed identity token (JWT) proving who they are.
                                </div>
                                <div class="flow-assumption">
                                    <strong>Demo assumption:</strong> We skip this step. A Salesforce Apex
                                    endpoint signs the JWT using a server-side certificate, simulating
                                    what an IdP would provide. The user
                                    <strong id="pre-subject">davidvickers@tdx25.020.com</strong>
                                    already has a token in hand.
                                </div>
                            </div>
                        </div>

                        <div class="flow-arrow">&#x25BC;</div>

                        <div class="flow-step pending">
                            <div class="flow-number">1</div>
                            <div class="flow-content">
                                <div class="flow-title">Get Signed Identity JWT</div>
                                <div class="flow-desc">
                                    Fetch the pre-signed JWT from the public Salesforce Site endpoint.
                                    No OAuth needed — the private key stays in Salesforce.
                                </div>
                            </div>
                        </div>

                        <div class="flow-arrow">&#x25BC;</div>

                        <div class="flow-step pending">
                            <div class="flow-number">2</div>
                            <div class="flow-content">
                                <div class="flow-title">Exchange JWT for MIAW Access Token</div>
                                <div class="flow-desc">
                                    SCRT2 receives the JWT, fetches the JWKS public key, verifies the
                                    signature and claims, and returns an <strong>AUTH</strong> (verified)
                                    or <strong>ANON</strong> (anonymous) token.
                                    Returns 200 OK either way — the only proof is checking AUTH vs ANON.
                                </div>
                            </div>
                        </div>

                        <div class="flow-arrow">&#x25BC;</div>

                        <div class="flow-step pending">
                            <div class="flow-number">3</div>
                            <div class="flow-content">
                                <div class="flow-title">Create Conversation + Subscribe to SSE</div>
                                <div class="flow-desc">
                                    Open a conversation and connect to the real-time event stream.
                                    The agent knows <em>who</em> is asking and can access
                                    verified-only topics and actions.
                                </div>
                            </div>
                        </div>

                        <div class="flow-arrow">&#x25BC;</div>

                        <div class="flow-step pending">
                            <div class="flow-number">4</div>
                            <div class="flow-content">
                                <div class="flow-title">Chat as Verified User</div>
                                <div class="flow-desc">
                                    Send messages and receive agent responses via SSE in real time.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pre-action">
                        <p>Click <strong>Connect</strong> to run Steps 1–3, then chat live with the agent.</p>
                    </div>
                </div>
            </div>

            <div id="input-area">
                <input
                    type="text"
                    id="message-input"
                    placeholder="Type a message..."
                    disabled
                    autocomplete="off"
                >
                <button id="send-btn" disabled>Send</button>
            </div>
        </section>
    </main>

    <script src="app.js"></script>
</body>
</html>
